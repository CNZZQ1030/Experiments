# è”é‚¦å­¦ä¹ æ¿€åŠ±æœºåˆ¶ - AMACè´¡çŒ®åº¦ä¸å·®å¼‚åŒ–æ¨¡å‹åˆ†å‘
# Federated Learning Incentive Mechanism - AMAC Contribution and Differentiated Model Distribution

## ğŸ“‹ ç›®å½• / Table of Contents
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
3. [æ ¸å¿ƒåˆ›æ–°](#æ ¸å¿ƒåˆ›æ–°)
4. [è¿è¡ŒæŒ‡å—](#è¿è¡ŒæŒ‡å—)
5. [å®éªŒé…ç½®](#å®éªŒé…ç½®)
6. [è¯„ä»·æŒ‡æ ‡](#è¯„ä»·æŒ‡æ ‡)

---

## ç³»ç»Ÿæ¦‚è¿° / System Overview

æœ¬ç³»ç»Ÿå®ç°äº†åŸºäºAMACï¼ˆAdaptive Magnitude-Aware Contributionï¼‰è´¡çŒ®åº¦è®¡ç®—çš„è”é‚¦å­¦ä¹ æ¿€åŠ±æœºåˆ¶ï¼Œé€šè¿‡å·®å¼‚åŒ–æ¨¡å‹åˆ†å‘ç­–ç•¥æ¿€åŠ±å®¢æˆ·ç«¯å‚ä¸ã€‚

### ä¸»è¦ç‰¹ç‚¹ / Key Features

1. **AMACè´¡çŒ®åº¦è®¡ç®—** / **AMAC Contribution Calculation**
   - è§£å†³ä¼ ç»ŸCGSVçš„"è´¡çŒ®é€’å‡"é—®é¢˜
   - è‡ªé€‚åº”å¹³è¡¡æ¢¯åº¦æ–¹å‘å’Œæ”¶æ•›æ€§
   - è®­ç»ƒåˆæœŸå…³æ³¨æ–¹å‘ï¼ŒåæœŸå…³æ³¨æ”¶æ•›

2. **å·®å¼‚åŒ–æ¨¡å‹åˆ†å‘** / **Differentiated Model Distribution**
   - è´¡çŒ®åº¦ä¸º0ï¼šä»…è·å¾—æœ¬åœ°æ¨¡å‹
   - è´¡çŒ®åº¦è¶Šé«˜ï¼šè·å¾—æ›´å¤šå…¶ä»–å®¢æˆ·ç«¯çš„æ›´æ–°
   - åŒç­‰çº§å®¢æˆ·ç«¯æ ¹æ®è´¡çŒ®åº¦è·å¾—ä¸åŒè´¨é‡æ¨¡å‹

3. **æ—¶é—´ç‰‡ç®¡ç†** / **Time Slice Management**
   - æ”¯æŒ5ç§æ—¶é—´ç‰‡åˆ’åˆ†æ–¹å¼
   - è´¡çŒ®åº¦ä¸æ—¶é—´ç‰‡ååŒç®¡ç†
   - ç§¯åˆ†æœ‰æ•ˆæœŸæœºåˆ¶

---

## å·¥ä½œæµç¨‹ / Workflow

### å®Œæ•´æµç¨‹å›¾ / Complete Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åˆå§‹åŒ–é˜¶æ®µ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ•°æ®åŠ è½½ä¸åˆ†å‰²ï¼ˆIID/Non-IIDï¼‰                          â”‚
â”‚ 2. æ¨¡å‹åˆå§‹åŒ–                                           â”‚
â”‚ 3. å®¢æˆ·ç«¯åˆ›å»º                                           â”‚
â”‚ 4. ç‹¬ç«‹è®­ç»ƒåŸºå‡†è®¡ç®—                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 è”é‚¦å­¦ä¹ è®­ç»ƒå¾ªç¯                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: å®¢æˆ·ç«¯é€‰æ‹©                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ åŸºäºä¼šå‘˜ç­‰çº§å’Œè´¡çŒ®åº¦è®¡ç®—ä¼˜å…ˆçº§                           â”‚
â”‚ â€¢ é«˜ä¼˜å…ˆçº§å®¢æˆ·ç«¯ä¼˜å…ˆè¢«é€‰ä¸­                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: æ¨¡å‹åˆ†å‘ï¼ˆå·®å¼‚åŒ–ï¼‰                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ ¹æ®å®¢æˆ·ç«¯è´¡çŒ®åº¦åˆ†å‘ä¸åŒè´¨é‡çš„ä¸ªæ€§åŒ–æ¨¡å‹                  â”‚
â”‚ â€¢ è´¡çŒ®åº¦=0ï¼šä»…æœ¬åœ°æ¨¡å‹                                   â”‚
â”‚ â€¢ è´¡çŒ®åº¦>0ï¼šæ ¹æ®è´¡çŒ®åº¦è·å–å…¶ä»–å®¢æˆ·ç«¯æ›´æ–°                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤3: æœ¬åœ°è®­ç»ƒ                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å®¢æˆ·ç«¯åœ¨æœ¬åœ°æ•°æ®ä¸Šè®­ç»ƒ                                  â”‚
â”‚ â€¢ è®°å½•è®­ç»ƒæ—¶é—´å’Œæ€§èƒ½æŒ‡æ ‡                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤4: AMACè´¡çŒ®åº¦è®¡ç®—                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Ci(t) = (1-Î»(t))Â·Sdir + Î»(t)Â·Sconv                   â”‚
â”‚ â€¢ Î»(t) = min(1, t/T)                                   â”‚
â”‚ â€¢ Sdir: æ–¹å‘è´¡çŒ®åˆ†ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰                          â”‚
â”‚ â€¢ Sconv: æ”¶æ•›è´¡çŒ®åˆ†ï¼ˆæ¢¯åº¦å¹…åº¦ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤5: æ—¶é—´ç‰‡ç§¯åˆ†æ›´æ–°                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æ›´æ–°å½“å‰æ—¶é—´ç‰‡å†…çš„è´¡çŒ®ç§¯åˆ†                              â”‚
â”‚ â€¢ æ¸…ç†è¿‡æœŸç§¯åˆ†                                          â”‚
â”‚ â€¢ æ›´æ–°ä¼šå‘˜ç­‰çº§                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤6: å…¨å±€æ¨¡å‹æ›´æ–°                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ åŸºäºè´¡çŒ®åº¦çš„åŠ æƒèšåˆ                                    â”‚
â”‚ â€¢ æ›´æ–°å…¨å±€æ¨¡å‹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¯„ä¼°ä¸è®°å½•                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ æµ‹è¯•å‡†ç¡®ç‡è®¡ç®—                                        â”‚
â”‚ â€¢ æ—¶é—´æ¶ˆè€—è®°å½•                                          â”‚
â”‚ â€¢ PCCè®¡ç®—ï¼ˆç‹¬ç«‹vsè”é‚¦å‡†ç¡®ç‡ç›¸å…³æ€§ï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒåˆ›æ–° / Core Innovation

### 1. AMACè´¡çŒ®åº¦è®¡ç®—å…¬å¼

```
Ci(t) = (1 - Î»(t)) Â· Sdir(gi, gagg) + Î»(t) Â· Sconv(gi)

å…¶ä¸­ï¼š
- Î»(t) = min(1, t/T): è‡ªé€‚åº”æƒé‡
- Sdir: æ–¹å‘è´¡çŒ®åˆ† = max(0, cosine_similarity(gi, gagg))
- Sconv: æ”¶æ•›è´¡çŒ®åˆ† = exp(-Î³ Â· ||gi||/G_bar)
- gi: å®¢æˆ·ç«¯içš„æ¢¯åº¦
- gagg: èšåˆæ¢¯åº¦
- G_bar: æ‰€æœ‰å®¢æˆ·ç«¯æ¢¯åº¦å¹…åº¦å‡å€¼
```

### 2. å·®å¼‚åŒ–æ¨¡å‹åˆ†å‘ç­–ç•¥

```python
# ä¼ªä»£ç 
def create_personalized_model(client_id, contribution):
    if contribution == 0:
        return client_local_model  # ä»…è¿”å›æœ¬åœ°æ¨¡å‹
    
    # æ ¹æ®è´¡çŒ®åº¦è®¡ç®—å¯è®¿é—®çš„æ›´æ–°æ•°é‡
    accessible_ratio = contribution * level_multiplier
    num_accessible = int(total_updates * accessible_ratio)
    
    # èšåˆå¯è®¿é—®çš„æ›´æ–°
    personalized_model = weighted_aggregate(accessible_updates)
    return personalized_model
```

---

## è¿è¡ŒæŒ‡å— / Running Guide

### ç¯å¢ƒè¦æ±‚ / Requirements

```bash
Python >= 3.7
PyTorch >= 1.9.0
NumPy >= 1.19.5
SciPy >= 1.5.0
tqdm
matplotlib
seaborn
```

### åŸºæœ¬è¿è¡Œå‘½ä»¤ / Basic Commands

#### 1. è¿è¡Œå•ä¸ªå®éªŒ / Run Single Experiment

```bash
# IIDæ•°æ®åˆ†å¸ƒ + roundsæ—¶é—´ç‰‡
python main.py --dataset cifar10 --num_clients 100 --num_rounds 100 --distribution iid --time_slice rounds

# Non-IIDæ•°æ®åˆ†å¸ƒ + dynamicæ—¶é—´ç‰‡
python main.py --dataset mnist --num_clients 50 --num_rounds 80 --distribution non-iid --time_slice dynamic
```

#### 2. æ¯”è¾ƒæ•°æ®åˆ†å¸ƒ / Compare Data Distributions

```bash
# æ¯”è¾ƒIID vs Non-IID
python main.py --dataset cifar10 --compare_distributions
```

#### 3. æ¯”è¾ƒæ—¶é—´ç‰‡æ–¹æ³• / Compare Time Slice Methods

```bash
# æ¯”è¾ƒ5ç§æ—¶é—´ç‰‡æ–¹æ³•
python main.py --dataset mnist --distribution iid --compare_time_slices
```

#### 4. æ¯”è¾ƒä¸åŒæ•°æ®é›† / Compare Different Datasets

```bash
# æ¯”è¾ƒMNIST, Fashion-MNIST, CIFAR-10
python main.py --compare_datasets --distribution iid --time_slice rounds
```

### å‚æ•°è¯´æ˜ / Parameter Description

| å‚æ•° / Parameter | ç±»å‹ / Type | é»˜è®¤å€¼ / Default | è¯´æ˜ / Description |
|-----------------|-------------|-----------------|-------------------|
| --dataset | str | cifar10 | æ•°æ®é›†é€‰æ‹© (mnist/fashion-mnist/cifar10/cifar100) |
| --num_clients | int | 100 | å®¢æˆ·ç«¯æ•°é‡ |
| --num_rounds | int | 100 | è®­ç»ƒè½®æ¬¡ |
| --distribution | str | iid | æ•°æ®åˆ†å¸ƒç±»å‹ (iid/non-iid) |
| --time_slice | str | rounds | æ—¶é—´ç‰‡ç±»å‹ (rounds/days/phases/dynamic/completion) |
| --experiment_name | str | auto | å®éªŒåç§°ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ |
| --seed | int | 42 | éšæœºç§å­ |
| --device | str | auto | è®¡ç®—è®¾å¤‡ (auto/cpu/cuda) |

---

## å®éªŒé…ç½® / Experiment Configuration

### æ—¶é—´ç‰‡ç±»å‹è¯´æ˜ / Time Slice Types

1. **rounds**: åŸºäºå›ºå®šè½®æ¬¡æ•°
   - æ¯Nè½®ä¸ºä¸€ä¸ªæ—¶é—´ç‰‡

2. **days**: åŸºäºå®é™…å¤©æ•°
   - æ¯Må¤©ä¸ºä¸€ä¸ªæ—¶é—´ç‰‡

3. **phases**: åŸºäºè®­ç»ƒé˜¶æ®µ
   - åˆ†ä¸ºé¢„è®­ç»ƒã€å¾®è°ƒç­‰é˜¶æ®µ

4. **dynamic**: åŠ¨æ€è°ƒæ•´
   - æ ¹æ®ç³»ç»Ÿæ´»è·ƒåº¦è°ƒæ•´æ—¶é—´ç‰‡é•¿åº¦

5. **completion**: åŸºäºä»»åŠ¡å®Œæˆåº¦
   - æŒ‰ç…§è®­ç»ƒè¿›åº¦ç™¾åˆ†æ¯”åˆ’åˆ†

### æ•°æ®åˆ†å¸ƒé…ç½® / Data Distribution Configuration

- **IID (ç‹¬ç«‹åŒåˆ†å¸ƒ)**: 
  - æ•°æ®éšæœºå‡åŒ€åˆ†é…ç»™å®¢æˆ·ç«¯
  - æ¯ä¸ªå®¢æˆ·ç«¯æ•°æ®åˆ†å¸ƒç›¸ä¼¼

- **Non-IID (éç‹¬ç«‹åŒåˆ†å¸ƒ)**: 
  - ä½¿ç”¨Dirichletåˆ†å¸ƒ
  - Î±å‚æ•°æ§åˆ¶å¼‚è´¨æ€§ç¨‹åº¦ï¼ˆé»˜è®¤0.5ï¼‰

---

## è¯„ä»·æŒ‡æ ‡ / Evaluation Metrics

### 1. æµ‹è¯•å‡†ç¡®ç‡ / Test Accuracy
- å…¨å±€æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡
- è®°å½•æ¯è½®çš„å‡†ç¡®ç‡å˜åŒ–

### 2. æ—¶é—´æ¶ˆè€— / Time Consumption
- æ¯è½®è®­ç»ƒæ—¶é—´
- æ€»è®­ç»ƒæ—¶é—´
- å¹³å‡æ¯è½®æ—¶é—´

### 3. çš®å°”é€Šç›¸å…³ç³»æ•° (PCC) / Pearson Correlation Coefficient

**è®¡ç®—æ–¹æ³•**:
1. æ”¶é›†æ‰€æœ‰å®¢æˆ·ç«¯çš„ç‹¬ç«‹è®­ç»ƒå‡†ç¡®ç‡ï¼ˆstandalone_accuracyï¼‰
2. æ”¶é›†æ‰€æœ‰å®¢æˆ·ç«¯çš„è”é‚¦å­¦ä¹ æœ€ç»ˆå‡†ç¡®ç‡ï¼ˆfederated_accuracyï¼‰
3. è®¡ç®—ä¸¤ä¸ªå‘é‡çš„ç›¸å…³ç³»æ•°

**è§£é‡Š**:
- PCC â‰ˆ 1: å¼ºæ­£ç›¸å…³ï¼ˆç†æƒ³æƒ…å†µï¼‰
- PCC > 0.8: å¼ºç›¸å…³
- 0.5 < PCC < 0.8: ä¸­ç­‰ç›¸å…³
- PCC < 0.5: å¼±ç›¸å…³

**å¯è§†åŒ–**:
- æ•£ç‚¹å›¾æ˜¾ç¤ºç‹¬ç«‹vsè”é‚¦å‡†ç¡®ç‡
- å›å½’çº¿æ˜¾ç¤ºç›¸å…³æ€§è¶‹åŠ¿
- æŸ±çŠ¶å›¾æ˜¾ç¤ºæ€§èƒ½æå‡åˆ†å¸ƒ

---

## è¾“å‡ºæ–‡ä»¶è¯´æ˜ / Output Files

```
outputs/
â”œâ”€â”€ results/           # å®éªŒç»“æœ
â”‚   â”œâ”€â”€ {experiment_name}_metrics.json    # è¯¦ç»†æŒ‡æ ‡
â”‚   â””â”€â”€ {experiment_name}_config.json     # å®éªŒé…ç½®
â”œâ”€â”€ plots/            # å¯è§†åŒ–å›¾è¡¨
â”‚   â”œâ”€â”€ {experiment_name}_pcc_analysis.png      # PCCåˆ†æå›¾
â”‚   â”œâ”€â”€ {experiment_name}_training_curves.png   # è®­ç»ƒæ›²çº¿
â”‚   â””â”€â”€ {experiment_name}_contribution_heatmap.png # è´¡çŒ®åº¦çƒ­åŠ›å›¾
â””â”€â”€ logs/             # æ—¥å¿—æ–‡ä»¶
    â””â”€â”€ experiment.log
```

---

## å¸¸è§é—®é¢˜ / FAQ

**Q: å¦‚ä½•è°ƒæ•´AMACå‚æ•°ï¼Ÿ**
A: ä¿®æ”¹`AMACContributionCalculator`çš„åˆå§‹åŒ–å‚æ•°ï¼š
- T: è½¬æŠ˜ç‚¹è½®æ¬¡ï¼ˆé»˜è®¤200ï¼‰
- gamma: æ”¶æ•›åˆ†æ•°æ•æ„Ÿåº¦ï¼ˆé»˜è®¤1.0ï¼‰

**Q: å¦‚ä½•ä¿®æ”¹ä¼šå‘˜ç­‰çº§é˜ˆå€¼ï¼Ÿ**
A: åœ¨`config.py`ä¸­ä¿®æ”¹`LEVEL_THRESHOLDS`ï¼š
```python
LEVEL_THRESHOLDS = {
    'bronze': 0,
    'silver': 2000,
    'gold': 6000,
    'diamond': 15000
}
```

**Q: å¦‚ä½•æ·»åŠ æ–°çš„æ•°æ®é›†ï¼Ÿ**
A: åœ¨`datasets/data_loader.py`ä¸­æ·»åŠ æ–°çš„åŠ è½½å‡½æ•°ï¼Œå¹¶åœ¨`DatasetConfig`ä¸­æ³¨å†Œã€‚

---

## è”ç³»æ–¹å¼ / Contact

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–Pull Requestã€‚

---

## å¼•ç”¨ / Citation

å¦‚æœä½¿ç”¨æœ¬ä»£ç ï¼Œè¯·å¼•ç”¨ï¼š
```bibtex
@software{fl_amac_2024,
  title = {Federated Learning with AMAC and Differentiated Model Distribution},
  year = {2024}
}
```

# è”é‚¦å­¦ä¹ é¡¹ç›®æ‰©å±•ä½¿ç”¨æŒ‡å—
# Federated Learning Extended Project Usage Guide

## ğŸ“‹ æ›´æ–°æ¦‚è¿° / Update Overview

æœ¬æ¬¡æ›´æ–°æ·»åŠ äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

### æ–°å¢æ•°æ®é›† / New Datasets
1. **CIFAR-100** - 100ç±»å›¾åƒåˆ†ç±»
2. **SST** - Stanford Sentiment Treebank æƒ…æ„Ÿåˆ†æ

### æ–°å¢æ•°æ®åˆ†å¸ƒç±»å‹ / New Distribution Types
1. **iid** - ç‹¬ç«‹åŒåˆ†å¸ƒ / IID
2. **non-iid-dir** - Dirichletåˆ†å¸ƒ (åŸnon-iid) / Dirichlet distribution
3. **non-iid-size** - æ•°æ®é‡ä¸å¹³è¡¡ / Imbalanced dataset size
4. **non-iid-class** - ç±»åˆ«æ•°ä¸å¹³è¡¡ / Imbalanced class number

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ / Quick Start

### åŸºæœ¬å‘½ä»¤æ ¼å¼ / Basic Command Format
```bash
python main.py --dataset <DATASET> --distribution <DISTRIBUTION> [OPTIONS]
```

---

## ğŸ“ å‘½ä»¤è¡Œå‚æ•°è¯¦è§£ / Command Line Arguments

### æ•°æ®é›†å‚æ•° / Dataset Parameters
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|-------|------|
| `--dataset` | str | mnist | æ•°æ®é›†: mnist, fashion-mnist, cifar10, cifar100, sst |
| `--num_clients` | int | 100 | å®¢æˆ·ç«¯æ•°é‡ |

### åˆ†å¸ƒå‚æ•° / Distribution Parameters
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|-------|------|
| `--distribution` | str | iid | åˆ†å¸ƒç±»å‹: iid, non-iid-dir, non-iid-size, non-iid-class |
| `--alpha` | float | 0.5 | Dirichletå‚æ•° (ç”¨äºnon-iid-dir) |
| `--size_ratio` | float | 5.0 | æ•°æ®é‡ä¸å¹³è¡¡æ¯”ä¾‹ (ç”¨äºnon-iid-size) |
| `--min_classes` | int | 2 | æ¯å®¢æˆ·ç«¯æœ€å°‘ç±»åˆ«æ•° (ç”¨äºnon-iid-class) |
| `--max_classes` | int | 5 | æ¯å®¢æˆ·ç«¯æœ€å¤šç±»åˆ«æ•° (ç”¨äºnon-iid-class) |

### è®­ç»ƒå‚æ•° / Training Parameters
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|-------|------|
| `--num_rounds` | int | 50 | é€šä¿¡è½®æ¬¡ |
| `--local_epochs` | int | 5 | æ¯è½®æœ¬åœ°è®­ç»ƒè½®æ¬¡ |
| `--batch_size` | int | 32 | æ‰¹æ¬¡å¤§å° |
| `--learning_rate` | float | 0.01 | å­¦ä¹ ç‡ |
| `--standalone_epochs` | int | 20 | ç‹¬ç«‹è®­ç»ƒè½®æ¬¡ |

### å…¶ä»–å‚æ•° / Other Parameters
| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|-------|------|
| `--seed` | int | 42 | éšæœºç§å­ |
| `--device` | str | auto | è®¡ç®—è®¾å¤‡: auto, cpu, cuda |

---

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹ / Usage Examples

### 1. IIDåˆ†å¸ƒå®éªŒ / IID Distribution Experiments

```bash
# MNIST with IID / MNIST IIDåˆ†å¸ƒ
python main.py --dataset mnist --distribution iid --num_clients 100 --num_rounds 50

# CIFAR-10 with IID / CIFAR-10 IIDåˆ†å¸ƒ
python main.py --dataset cifar10 --distribution iid --num_clients 100 --num_rounds 100

# CIFAR-100 with IID / CIFAR-100 IIDåˆ†å¸ƒ
python main.py --dataset cifar100 --distribution iid --num_clients 100 --num_rounds 150

# SST with IID / SST IIDåˆ†å¸ƒ
python main.py --dataset sst --distribution iid --num_clients 50 --num_rounds 30
```

### 2. Dirichlet Non-IIDåˆ†å¸ƒ / Dirichlet Non-IID Distribution

```bash
# MNIST with Dirichlet (Î±=0.1, é«˜åº¦éç‹¬ç«‹åŒåˆ†å¸ƒ)
python main.py --dataset mnist --distribution non-iid-dir --alpha 0.1

# CIFAR-10 with Dirichlet (Î±=0.5, ä¸­ç­‰éç‹¬ç«‹åŒåˆ†å¸ƒ)
python main.py --dataset cifar10 --distribution non-iid-dir --alpha 0.5

# CIFAR-100 with Dirichlet (Î±=1.0, è½»åº¦éç‹¬ç«‹åŒåˆ†å¸ƒ)
python main.py --dataset cifar100 --distribution non-iid-dir --alpha 1.0

# SST with Dirichlet
python main.py --dataset sst --distribution non-iid-dir --alpha 0.5
```

**Alphaå‚æ•°è¯´æ˜ / Alpha Parameter Guide:**
- Î± < 0.1: æç«¯Non-IID (æ¯ä¸ªå®¢æˆ·ç«¯å‡ ä¹åªæœ‰1-2ä¸ªç±»åˆ«)
- Î± = 0.5: ä¸­ç­‰Non-IID
- Î± = 1.0: è½»åº¦Non-IID
- Î± > 10: æ¥è¿‘IID

### 3. æ•°æ®é‡ä¸å¹³è¡¡åˆ†å¸ƒ / Imbalanced Dataset Size

```bash
# MNIST with size ratio 5.0 (æœ€å¤§å®¢æˆ·ç«¯æ•°æ®é‡æ˜¯æœ€å°çš„5å€)
python main.py --dataset mnist --distribution non-iid-size --size_ratio 5.0

# CIFAR-10 with size ratio 10.0
python main.py --dataset cifar10 --distribution non-iid-size --size_ratio 10.0

# CIFAR-100 with size ratio 8.0
python main.py --dataset cifar100 --distribution non-iid-size --size_ratio 8.0
```

### 4. ç±»åˆ«æ•°ä¸å¹³è¡¡åˆ†å¸ƒ / Imbalanced Class Number

```bash
# MNIST: æ¯å®¢æˆ·ç«¯1-3ä¸ªç±»åˆ« (æç«¯ä¸å¹³è¡¡)
python main.py --dataset mnist --distribution non-iid-class --min_classes 1 --max_classes 3

# CIFAR-10: æ¯å®¢æˆ·ç«¯2-5ä¸ªç±»åˆ«
python main.py --dataset cifar10 --distribution non-iid-class --min_classes 2 --max_classes 5

# CIFAR-100: æ¯å®¢æˆ·ç«¯5-20ä¸ªç±»åˆ«
python main.py --dataset cifar100 --distribution non-iid-class --min_classes 5 --max_classes 20
```

### 5. å®Œæ•´é…ç½®ç¤ºä¾‹ / Full Configuration Examples

```bash
# å®Œæ•´CIFAR-10 Dirichletå®éªŒ
python main.py \
    --dataset cifar10 \
    --distribution non-iid-dir \
    --alpha 0.5 \
    --num_clients 100 \
    --num_rounds 100 \
    --local_epochs 5 \
    --batch_size 32 \
    --learning_rate 0.01 \
    --standalone_epochs 20 \
    --seed 42

# å®Œæ•´CIFAR-100ç±»åˆ«ä¸å¹³è¡¡å®éªŒ
python main.py \
    --dataset cifar100 \
    --distribution non-iid-class \
    --min_classes 10 \
    --max_classes 30 \
    --num_clients 50 \
    --num_rounds 150 \
    --local_epochs 3 \
    --batch_size 64 \
    --learning_rate 0.005 \
    --standalone_epochs 30

# SSTæ–‡æœ¬åˆ†ç±»å®éªŒ
python main.py \
    --dataset sst \
    --distribution non-iid-dir \
    --alpha 0.5 \
    --num_clients 30 \
    --num_rounds 50 \
    --local_epochs 5 \
    --batch_size 32
```

---

## ğŸ“Š åˆ†å¸ƒç±»å‹å¯¹æ¯” / Distribution Type Comparison

| åˆ†å¸ƒç±»å‹ | æ•°æ®é‡ | ç±»åˆ«åˆ†å¸ƒ | é€‚ç”¨åœºæ™¯ |
|---------|--------|---------|---------|
| iid | å‡åŒ€ | å‡åŒ€ | åŸºå‡†æµ‹è¯• |
| non-iid-dir | ä¸å‡åŒ€ | ä¸å‡åŒ€ | æ¨¡æ‹ŸçœŸå®åœºæ™¯çš„æ ‡ç­¾åæ–œ |
| non-iid-size | ä¸å‡åŒ€ | å‡åŒ€ | æ¨¡æ‹Ÿè®¾å¤‡å­˜å‚¨å®¹é‡å·®å¼‚ |
| non-iid-class | å‡åŒ€ | ä¸å‡åŒ€ | æ¨¡æ‹Ÿä¸“ä¸šåŒ–è®¾å¤‡ |

---

## ğŸ”§ ä»£ç ä¿®æ”¹è¯´æ˜ / Code Modification Details

### ä¿®æ”¹çš„æ–‡ä»¶ / Modified Files

1. **config.py**
   - æ·»åŠ æ–°åˆ†å¸ƒç±»å‹æ”¯æŒ
   - æ·»åŠ SSTæ•°æ®é›†é…ç½®
   - æ·»åŠ ä¸å¹³è¡¡åˆ†å¸ƒå‚æ•°

2. **datasets/data_loader.py**
   - æ·»åŠ SSTDatasetç±»
   - æ·»åŠ `_create_size_imbalanced_splits()`æ–¹æ³•
   - æ·»åŠ `_create_class_imbalanced_splits()`æ–¹æ³•
   - é‡æ„`_create_dirichlet_splits()`æ–¹æ³•

3. **models/cnn_model.py**
   - æ·»åŠ TextCNNæ¨¡å‹
   - æ·»åŠ TextLSTMæ¨¡å‹
   - æ›´æ–°ModelFactory

4. **main.py**
   - æ·»åŠ æ–°å‘½ä»¤è¡Œå‚æ•°
   - æ›´æ–°ç»„ä»¶åˆå§‹åŒ–é€»è¾‘
   - æ·»åŠ ä½¿ç”¨ç¤ºä¾‹

---

## ğŸ“ˆ è¾“å‡ºæ–‡ä»¶ / Output Files

è¿è¡Œå®éªŒåï¼Œç»“æœå°†ä¿å­˜åœ¨ä»¥ä¸‹ä½ç½®ï¼š

```
outputs/
â”œâ”€â”€ results/           # å®éªŒç»“æœJSON
â”œâ”€â”€ figures/           # å¯è§†åŒ–å›¾è¡¨
â””â”€â”€ logs/             # æ—¥å¿—æ–‡ä»¶
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹ / Notes

1. **CIFAR-100** éœ€è¦æ›´å¤šè®­ç»ƒè½®æ¬¡(å»ºè®®150+)ä»¥è¾¾åˆ°æ”¶æ•›
2. **SST** æ•°æ®é›†é¦–æ¬¡è¿è¡Œæ—¶ä¼šç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…ä½¿ç”¨æ—¶å¯æ›¿æ¢ä¸ºçœŸå®æ•°æ®
3. **non-iid-class** åˆ†å¸ƒä¸­ï¼Œ`max_classes`ä¸èƒ½è¶…è¿‡æ•°æ®é›†çš„ç±»åˆ«æ€»æ•°
4. ä½¿ç”¨GPUæ—¶å»ºè®®å¢å¤§`batch_size`ä»¥æé«˜æ•ˆç‡

---

## ğŸ“ æ•…éšœæ’é™¤ / Troubleshooting

**Q: å†…å­˜ä¸è¶³ / Out of Memory**
```bash
# å‡å°batch_sizeå’Œnum_clients
python main.py --dataset cifar100 --batch_size 16 --num_clients 50
```

**Q: è®­ç»ƒå¤ªæ…¢ / Training too slow**
```bash
# å‡å°‘local_epochsæˆ–num_rounds
python main.py --dataset cifar10 --local_epochs 3 --num_rounds 30
```

**Q: SSTæ•°æ®é›†æ‰¾ä¸åˆ° / SST dataset not found**
```
é¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼Œä¿å­˜åœ¨ ./data/sst/ ç›®å½•
```

---

## ğŸ¯ æ¨èå®éªŒé…ç½® / Recommended Configurations

### å¿«é€Ÿæµ‹è¯• / Quick Test
```bash
python main.py --dataset mnist --distribution iid --num_clients 10 --num_rounds 10
```

### æ ‡å‡†IIDåŸºå‡† / Standard IID Baseline
```bash
python main.py --dataset cifar10 --distribution iid --num_clients 100 --num_rounds 100
```

### Non-IIDæ€§èƒ½æµ‹è¯• / Non-IID Performance Test
```bash
python main.py --dataset cifar10 --distribution non-iid-dir --alpha 0.5 --num_clients 100 --num_rounds 100
```

### æç«¯Non-IIDæµ‹è¯• / Extreme Non-IID Test
```bash
python main.py --dataset cifar10 --distribution non-iid-class --min_classes 1 --max_classes 2 --num_clients 100 --num_rounds 150
```